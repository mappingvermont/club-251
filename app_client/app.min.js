!function(){function e(e,t,n){e.when("/",{templateUrl:"home/home.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/register",{templateUrl:"/auth/register/register.view.html",controller:"registerCtrl",controllerAs:"vm"}).when("/login",{templateUrl:"/auth/login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).when("/profile",{templateUrl:"/profile/profile.view.html",controller:"profileCtrl",controllerAs:"vm"}).when("/users/:username",{templateUrl:"/users/users.view.html",controller:"userCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/"}),t.html5Mode(!0),n.debugEnabled(!1)}function t(e,t,n,o){e.$on("$routeChangeStart",function(e,n,r){"/profile"!==t.path()||o.isLoggedIn()||t.path("/")})}angular.module("meanApp",["ngRoute","leaflet-directive"]),angular.module("meanApp").config(["$routeProvider","$locationProvider","$logProvider",e]).run(["$rootScope","$location","$http","authentication",t])}(),function(){function e(e,t){console.log("Home controller is running"),console.log("And here");var n=this;n.users=[],t.getUsers().success(function(e){n.users=e,console.log(n.users)}).error(function(e){console.log(e)})}angular.module("meanApp").controller("homeCtrl",e),e.$inject=["$location","meanUsers"]}(),function(){function e(e,o,i,a,l,s){angular.extend(o,{vermont:{lat:43.9,lng:-72.4,zoom:8},defaults:{scrollWheelZoom:!1},layers:{baselayers:{osm:{name:"Esri World_Topo_Map",url:"http://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}",type:"xyz",attribution:"Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community",layerOptions:{showOnSelector:!1}}},overlays:{}},legend:{position:"bottomright",colors:["#ff7f00","#377eb8","#e41a1c","#999999"],labels:["Hiking","Biking","Driving","Not yet"]}});var u=this;u.user={},s.getProfile().success(function(e){u.user=e,r(o),t(o,a,e,u,l)}).error(function(e){console.log(e)}),o.messageClick=function(e){n(e),u.user.towns[e.feature.properties.fips6]=e.feature.properties.status,r(o),s.setProfile(e.feature.properties).success(function(e){}).error(function(e){console.log(e)})},o.$on("leafletDirectiveMap.popupopen",function(e,t){var n=t.leafletEvent.popup.options.feature,r=o.$new();r.stream=n,r.layer=o.layer,r.layer.status_options=["Not yet","Biking","Hiking","Driving"],i(t.leafletEvent.popup._contentNode)(r)})}function t(e,t,r,i,a){a.getMap().then(function(i){t.get("../data/towns.geojson").success(function(t,i){function a(t,i){var a=i.feature.properties.fips6;i.feature.properties.status=r.towns[a],n(i),o(t,i),i.on({click:function(){e.layer=i}})}angular.extend(e.layers.overlays,{countries:{name:"Club 251 Progress",type:"geoJSONShape",data:t,visible:!0,layerOptions:{onEachFeature:a}}})})})}function n(e){var t=a[e.feature.properties.status]||a.other;e.setStyle({color:t,fill:t,weight:1})}function o(e,t){var n=document.createElement("DIV"),o="<div class='popup_box_header'><strong>{{layer.feature.properties.town}}</strong></div><hr />";o+='Status: <select ng-model="layer.feature.properties.status" ng-change=messageClick(layer) ',o+='ng-options="v for v in layer.status_options"></select>',o+="</select>",n.innerHTML=o,t.bindPopup(n)}function r(e){var t=[],n=e.vm.user.towns;for(var o in n)t.push(n[o]);var r={};t.map(function(e){e in r?r[e]++:r[e]=1}),console.log(r),e.vm.user.local={},e.vm.user.local.driving=r.Driving||0,e.vm.user.local.hiking=r.Hiking||0,e.vm.user.local.biking=r.Biking||0,e.vm.user.local.not_yet=r["Not yet"]||0,console.log(e.vm.user.local),i(e)}function i(e){function t(){m.style("display","inline")}function n(e){m.text(e.y+": "+e.x).style("opacity",1).style("left",d3.event.pageX-34+"px").style("top",d3.event.pageY-12+"px")}function o(){m.style("display","none")}var r={top:12,left:0,right:0,bottom:12},i=parseInt(d3.select("#chart").style("width"),10),i=i=i-r.left-r.right,a=30-r.top-r.bottom,l=[{data:[{group_name:"Hiking",count:e.vm.user.local.hiking}],name:"Hiking"},{data:[{group_name:"Biking",count:e.vm.user.local.biking}]},{data:[{group_name:"Driving",count:e.vm.user.local.driving}]},{data:[{group_name:"Not yet",count:e.vm.user.local.not_yet}]}],l=l.map(function(e){return e.data.map(function(e,t){return{y:e.count,x:e.group_name}})}),s=d3.layout.stack();s(l);var l=l.map(function(e){return e.map(function(e){return{x:e.y,y:e.x,x0:e.y0}})}),u=d3.select("#chart").append("svg").attr("width",i+r.left+r.right).attr("height",a+r.top+r.bottom).append("g").attr("transform","translate("+r.left+","+r.top+")"),c=d3.max(l,function(e){return d3.max(e,function(e){return e.x+e.x0})}),g=d3.scale.linear().domain([0,c]).range([0,i]),p=d3.scale.ordinal().rangeRoundBands([0,a],.1),f=u.selectAll("g").data(l).enter().append("svg").style("fill",function(e,t){var n=["#ff7f00","#377eb8","#e41a1c","#999999"];return n[t]}),m=(f.selectAll("rect").data(function(e){return e}).enter().append("rect").attr("x",function(e){return g(e.x0)}).attr("y",function(e,t){return p(e.y)}).attr("height",function(e){return p.rangeBand()}).attr("width",function(e){return g(e.x)}).on("mouseover",t).on("mousemove",function(e){n(e)}).on("mouseout",o),d3.select("#chart").append("div").attr("class","tooltip").style("display","none"))}angular.module("meanApp").controller("profileCtrl",e),e.$inject=["$location","$scope","$compile","$http","leafletData","meanData"];var a={Hiking:"#ff7f00",Biking:"#377eb8",Driving:"#e41a1c","Not yet":"#999999"}}(),function(){function e(e,t,n){console.log("in users.controller.js");var o=t.username,r=this;r.towns={},n.singleUser(o).success(function(e){r.towns=e,console.log("town data:"),console.log(e)}).error(function(e){console.log(e)})}angular.module("meanApp").controller("userCtrl",e),e.$inject=["$location","$routeParams","meanUsers"]}(),function(){function e(e,t){var n=this;n.credentials={email:"",password:""},n.onSubmit=function(){t.login(n.credentials).error(function(e){alert(e)}).then(function(){e.path("profile")})}}angular.module("meanApp").controller("loginCtrl",e),e.$inject=["$location","authentication"]}(),function(){function e(){var e=[9030,11040,11015,11050,11060,13005,9080,9005,19050,19060,19085,9060,13015,11075,19070,9065,11080,13020,11020,19090,19020,11070,19015,11030,9015,9020,19055,19065,11010,11065,19095,9045,9025,15005,11045,19005,13010,15045,11025,5040,11035,19010,5070,19040,7050,9040,19030,15010,5060,13025,9050,19045,5010,7080,15030,15050,7075,5085,9055,9085,15025,15035,5025,5065,5030,15040,15020,5035,5075,9070,7045,5055,9035,23095,23100,7005,5080,23025,7060,5005,23050,5045,23030,7020,7040,23090,23045,23035,23060,23055,1095,5020,23070,1060,23040,23015,1025,23010,17040,23005,1015,17060,1100,1065,1075,1105,1050,17075,1005,17025,1110,17020,1055,1080,1010,1020,17070,17080,17030,1040,17065,1085,27075,1090,17050,27020,17055,27080,1070,21075,27085,27095,27055,27015,21005,27040,21047,27025,21135,21035,27045,27060,21110,27070,27115,21125,21060,21070,27050,21030,21065,27105,27005,27090,3045,3015,3030,3020,25050,25030,25110,3050,3075,3025,25045,25080,25095,3005,3070,25075,25015,25090,3060,3018,25073,25065,25060,25020,25025,3010,3080,3055,25105,25055,25010,3040,3035,3065,25100,25040,25035,25085,11055,15015,9075,7025,5015,7090,23020,7065,7055,7035,27065,27120,21095,7015,17010,17045,7030,5050,17035,7070,7085,17085,17015,17005,21085,21120,21130,21055,27110,27035,27030,27011,27100,19080,19035,19025,19075,23065,23080,25070,25005,1035,23075,23085,1030,1115,1045,21020,21115,21040,21015,21045,21010,21080,21140,21090,21100,21050,21025],t={};for(i=0;i<e.length;i++)t[e[i]]="Not yet";return t}function t(t,n){var o=this;o.credentials={name:"",email:"",password:"",towns:e()},o.onSubmit=function(){console.log("Submitting registration"),console.log(o.credentials),n.register(o.credentials).error(function(e){alert(e)}).then(function(){t.path("profile")})}}angular.module("meanApp").controller("registerCtrl",t),t.$inject=["$location","authentication"]}(),function(){function e(e,t){var n=function(e){t.localStorage["mean-token"]=e},o=function(){return t.localStorage["mean-token"]},r=function(){var e,n=o();return!!n&&(e=n.split(".")[1],e=t.atob(e),e=JSON.parse(e),e.exp>Date.now()/1e3)},i=function(){if(r()){var e=o(),n=e.split(".")[1];return n=t.atob(n),n=JSON.parse(n),{email:n.email,name:n.name}}};return register=function(t){return e.post("/api/register",t).success(function(e){console.log("registering user!"),console.log(e),n(e.token)})},login=function(t){return e.post("/api/login",t).success(function(e){n(e.token)})},logout=function(){t.localStorage.removeItem("mean-token")},{currentUser:i,saveToken:n,getToken:o,isLoggedIn:r,register:register,login:login,logout:logout}}angular.module("meanApp").service("authentication",e),e.$inject=["$http","$window"]}(),function(){function e(e,t){var n=function(){return e.get("/api/profile",{headers:{Authorization:"Bearer "+t.getToken()}})},o=function(n){return console.log("in set prof"),console.log(t.getToken()),e.put("/api/profile/"+n.fips6,n,{headers:{Authorization:"Bearer "+t.getToken()}})};return{getProfile:n,setProfile:o}}angular.module("meanApp").service("meanData",e),e.$inject=["$http","authentication"]}(),function(){function e(e,t){var n=function(){return console.log("calling find all users"),e.get("/api/users",{})},o=function(t){return console.log("calling singleUser for: "+t),e.get("/api/users/"+t,{})};return{getUsers:n,singleUser:o}}angular.module("meanApp").service("meanUsers",e),e.$inject=["$http","authentication"]}(),function(){function e(e,t){var n=this;n.isLoggedIn=t.isLoggedIn(),n.currentUser=t.currentUser()}angular.module("meanApp").controller("navigationCtrl",e),e.$inject=["$location","authentication"]}(),function(){function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}angular.module("meanApp").directive("navigation",e)}();
//# sourceMappingURL=app.min.js.map
