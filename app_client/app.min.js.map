{"version":3,"sources":["app.min.js"],"names":["config","$routeProvider","$locationProvider","$logProvider","when","templateUrl","controller","controllerAs","otherwise","redirectTo","html5Mode","debugEnabled","run","$rootScope","$location","$http","authentication","$on","event","nextRoute","currentRoute","path","isLoggedIn","angular","module","homeCtrl","meanUsers","console","log","vm","this","users","getUsers","success","data","error","e","$inject","profileCtrl","$scope","$compile","leafletData","meanData","extend","vermont","lat","lng","zoom","defaults","scrollWheelZoom","layers","baselayers","osm","name","url","type","attribution","layerOptions","showOnSelector","overlays","legend","position","colors","labels","user","getProfile","tabulateUserStats","initD3","updateData","joinTopoJson","messageClick","layer","style_poly","towns","feature","properties","fips6","status","setProfile","leafletEvent","popup","options","newScope","$new","stream","status_options","_contentNode","userData","getMap","then","map","get","onEachFeature","buildPopup","on","click","countries","visible","mouseover","div","d3","select","style","mousemove","d","text","pageX","pageY","mouseout","style_color","styles","setStyle","color","fill","weight","divNode","document","createElement","innerHTML","bindPopup","arr","push","groupby","a","local","driving","Driving","hiking","Hiking","biking","Biking","not_yet","colours","input_data","xOffset","value_list","i","length","datum","value","colour","y","x","bar","g","selectAll","enter","append","attr","xScale","yScale","margins","top","left","right","bottom","width","window","innerWidth","height","svg","scaleLinear","domain","range","scaleBand","rangeRound","Not yet","userCtrl","$routeParams","username","singleUser","loginCtrl","credentials","email","password","onSubmit","login","err","alert","populateTowns","fips6_list","registerCtrl","register","$window","saveToken","token","localStorage","getToken","payload","split","atob","JSON","parse","exp","Date","now","currentUser","post","logout","removeItem","service","headers","Authorization","input","put","navigationCtrl","navigation","restrict","directive"],"mappings":"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","file":"app.min.js","sourcesContent":["(function () {\n\n  angular.module('meanApp', ['ngRoute', 'leaflet-directive']);\n\n  function config ($routeProvider, $locationProvider, $logProvider) {\n    $routeProvider\n      .when('/', {\n        templateUrl: 'home/home.view.html',\n        controller: 'homeCtrl',\n        controllerAs: 'vm'\n      })\n      .when('/register', {\n        templateUrl: '/auth/register/register.view.html',\n        controller: 'registerCtrl',\n        controllerAs: 'vm'\n      })\n      .when('/login', {\n        templateUrl: '/auth/login/login.view.html',\n        controller: 'loginCtrl',\n        controllerAs: 'vm'\n      })\n      .when('/profile', {\n        templateUrl: '/profile/profile.view.html',\n        controller: 'profileCtrl',\n        controllerAs: 'vm'\n      })\n      .when('/users/:username', {\n        templateUrl: '/users/users.view.html',\n        controller: 'userCtrl',\n        controllerAs: 'vm'\n      })\n      .otherwise({redirectTo: '/'});\n\n    // use the HTML5 History API\n    $locationProvider.html5Mode(true);\n\n    //turn off leaflet logging\n    $logProvider.debugEnabled(false);\n\n  }\n\n  function run($rootScope, $location, $http, authentication) {\n    $rootScope.$on('$routeChangeStart', function(event, nextRoute, currentRoute) {\n      if ($location.path() === '/profile' && !authentication.isLoggedIn()) {\n        $location.path('/');\n      }\n    });\n  }\n  \n  angular\n    .module('meanApp')\n    .config(['$routeProvider', '$locationProvider', '$logProvider', config])\n    .run(['$rootScope', '$location', '$http', 'authentication', run]);\n\n})();\n(function() {\n  \n  angular\n    .module('meanApp')\n    .controller('homeCtrl', homeCtrl);\n\n  homeCtrl.$inject = ['$location', 'meanUsers'];\n  function homeCtrl($location, meanUsers) {\n  \tconsole.log('Home controller is running');\n  \tconsole.log('And here');\n\n    var vm = this;\n    vm.users = []\n\n    meanUsers.getUsers()\n      .success(function(data) {\n        vm.users = data;\n\n        console.log(vm.users);\n\n      })\n      .error(function (e) {\n        console.log(e);\n      });\n\n  }\n\n})();\n(function() {\n\n    angular\n        .module('meanApp')\n        .controller('profileCtrl', profileCtrl);\n\n\n    profileCtrl.$inject = ['$location', '$scope', '$compile', '$http', 'leafletData', 'meanData'];\n\n    function profileCtrl($location, $scope, $compile, $http, leafletData, meanData) {\n\n        angular.extend($scope, {\n            vermont: {\n                lat: 43.9,\n                lng: -72.4,\n                zoom: 8\n            },\n            defaults: {\n                scrollWheelZoom: false\n            },\n            layers: {\n                baselayers: {\n                    osm: {\n                        name: 'Esri World_Topo_Map',\n                        url: 'http://server.arcgisonline.com/ArcGIS/rest/services/World_Topo_Map/MapServer/tile/{z}/{y}/{x}',\n                        //url: 'http://{s}.tile.thunderforest.com/pioneer/{z}/{x}/{y}.png',\n                        type: 'xyz',\n                        attribution: 'Tiles &copy; Esri &mdash; Esri, DeLorme, NAVTEQ, TomTom, Intermap, iPC, USGS, FAO, NPS, NRCAN, GeoBase, Kadaster NL, Ordnance Survey, Esri Japan, METI, Esri China (Hong Kong), and the GIS User Community',\n                        layerOptions: {\n                            \"showOnSelector\": false\n                        }\n                    },\n                },\n                overlays: {}\n            },\n            legend: {\n                position: 'bottomright',\n                colors: ['#ff7f00', '#377eb8', '#e41a1c', '#999999'],\n                labels: ['Hiking', 'Biking', 'Driving', 'Not yet']\n            }\n        });\n\n        var vm = this;\n\n        vm.user = {};\n\n        meanData.getProfile()\n            .success(function(data) {\n                vm.user = data\n                tabulateUserStats($scope)\n                initD3($scope)\n                updateData($scope)\n                joinTopoJson($scope, $http, data, vm, leafletData)\n\n            })\n            .error(function(e) {\n                console.log(e);\n            });\n\n        $scope.messageClick = function(layer) {\n            //console.log('option ' + layer.feature.properties.status + ' selected for ' + layer.feature.properties.fips6 + '!');\n\n            style_poly(layer)\n\n            vm.user.towns[layer.feature.properties.fips6] = layer.feature.properties.status\n\n            tabulateUserStats($scope)\n\n            updateData($scope)\n                //console.log(vm.user.towns[layer.feature.properties.fips6])\n\n            meanData.setProfile(layer.feature.properties)\n                .success(function(data) {\n                    //console.log(data)\n                })\n                .error(function(e) {\n                    console.log(e);\n                });\n\n            //takes a while to update the status-- see if we can fix this?\n            //layer.feature.properties.status = layer.status\n\n        };\n\n        $scope.$on('leafletDirectiveMap.popupopen', function(event, leafletEvent) {\n\n            // Create the popup view when is opened\n            var feature = leafletEvent.leafletEvent.popup.options.feature;\n\n            var newScope = $scope.$new();\n            newScope.stream = feature;\n\n            newScope.layer = $scope.layer\n            newScope.layer.status_options = ['Not yet', 'Biking', 'Hiking', 'Driving']\n\n            $compile(leafletEvent.leafletEvent.popup._contentNode)(newScope);\n\n        });\n\n    }\n\n    function joinTopoJson($scope, $http, userData, vm, leafletData) {\n\n        leafletData.getMap().then(function(map) {\n\n            $http.get(\"../data/towns.geojson\").success(function(data, status) {\n\n                angular.extend($scope.layers.overlays, {\n                    countries: {\n                        name: 'Club 251 Progress',\n                        type: 'geoJSONShape',\n                        data: data,\n                        visible: true,\n                        layerOptions: {\n                            onEachFeature: onEachFeature\n                        }\n\n                    }\n                });\n\n                function onEachFeature(feature, layer) {\n\n                    var fips6 = layer.feature.properties.fips6\n                    layer.feature.properties.status = userData.towns[fips6]\n\n                    style_poly(layer)\n\n                    buildPopup(feature, layer)\n\n                    layer.on({\n                        click: function() {\n                            $scope.layer = layer;\n                        }\n                    })\n                }\n            });\n\n\n        });\n\n    }\n\n        function mouseover($scope) {\n            var div = d3.select('.tooltip')\n            //console.log(div)\n            console.log('mouseover')\n            div.style(\"display\", \"inline\");\n        }\n\n        function mousemove($scope, d) {\n            var div = d3.select('.tooltip')\n            console.log('mousemove')\n            div\n                .text('test: ok')\n                // .text(d.y + ': ' + d.x)\n                .style(\"opacity\", 1)\n                .style(\"left\", (d3.event.pageX - 34) + \"px\")\n                .style(\"top\", (d3.event.pageY - 12) + \"px\");\n        }\n\n        function mouseout($scope) {\n            console.log('mouseout')\n            var div = d3.select('.tooltip')\n            div.style(\"display\", \"none\");\n        }\n\n    var styles = {\n        'Hiking': '#ff7f00',\n        'Biking': '#377eb8',\n        //'Hiking': '#4daf4a', //green\n        'Driving': '#e41a1c',\n        'Not yet': '#999999'\n    }\n\n    function style_poly(layer) {\n\n        var style_color = (styles[layer.feature.properties.status] || styles['other']);\n\n        layer.setStyle({\n            color: style_color,\n            fill: style_color,\n            weight: 1,\n        })\n    }\n\n    function buildPopup(feature, layer) {\n\n        var divNode = document.createElement('DIV');\n\n        var popup = \"<div class='popup_box_header'><strong>{{layer.feature.properties.town}}</strong></div><hr />\"\n        popup += 'Status: <select ng-model=\"layer.feature.properties.status\" ng-change=messageClick(layer) '\n        popup += 'ng-options=\"v for v in layer.status_options\"></select>'\n        popup += '</select>'\n\n        divNode.innerHTML = popup\n        layer.bindPopup(divNode)\n\n    }\n\n    function tabulateUserStats($scope) {\n\n        var arr = []\n        var towns = $scope.vm.user.towns\n\n        for (var status in towns) {\n            arr.push(towns[status])\n        }\n\n        var groupby = {};\n        arr.map(function(a) {\n            if (a in groupby) groupby[a]++;\n            else groupby[a] = 1;\n        });\n        console.log(groupby);\n\n        $scope.vm.user.local = {}\n\n        $scope.vm.user.local.driving = groupby.Driving || 0\n        $scope.vm.user.local.hiking = groupby.Hiking || 0\n        $scope.vm.user.local.biking = groupby.Biking || 0\n        $scope.vm.user.local.not_yet = groupby['Not yet'] || 0\n\n        console.log($scope.vm.user.local)\n\n    }\n\n    function updateData($scope) {\n\n        var colours = ['#ff7f00', '#377eb8', '#e41a1c', '#999999']\n        var input_data = []\n        var xOffset = 0\n\n        //Process the data\n        var value_list = [$scope.vm.user.local.hiking, \n                          $scope.vm.user.local.biking,\n                          $scope.vm.user.local.driving,\n                          $scope.vm.user.local.not_yet]\n\n        console.log(value_list)\n\n        for(var i = 0; i < value_list.length; i++) {\n            var datum = {\n                value : value_list[i],\n                colour : colours[i],\n                y: 0,\n                x: xOffset\n\n            }\n            xOffset += value_list[i]\n            input_data.push(datum)      \n        }\n\n        var bar = $scope.g.selectAll(\".bar\")\n            .data(input_data, function(d) { return d.name; });\n\n        // new data:\n        bar.enter().append(\"rect\")\n            .attr(\"height\", 18)\n            .attr(\"x\", function(d) {return d.x})\n            .style(\"fill\", function(d) { return d.colour; })\n            .attr('x', function(d) {\n                console.log(d)\n                return $scope.xScale(d.x);\n            })\n            .attr('y', function(d, i) {\n                return $scope.yScale(d.y);\n            })\n            .attr('width', function(d) {\n                console.log($scope.xScale(d.value))\n                return $scope.xScale(d.value);\n            })\n\n            .on('mouseover', mouseover)\n            .on(\"mousemove\", function(d) {\n                mousemove(d)\n            })\n            .on(\"mouseout\", mouseout);\n\n    };\n\n\n    function initD3($scope) {\n\n        var margins = {\n                top: 12,\n                left: 0,\n                right: 0,\n                bottom: 25\n            },\n            width = window.innerWidth,\n            width = width - margins.left - margins.right,\n            height = 50 - margins.top - margins.bottom\n\n\n        var svg = d3.select(\"#chart\")\n            .attr('width', width)\n            .attr(\"height\", height)\n\n        $scope.xScale = d3.scaleLinear()\n            .domain([0, 251])\n            .range([0, width]),\n\n        $scope.yScale = d3.scaleBand()\n            .rangeRound([0, height], .1)\n\n        $scope.g = svg.append(\"g\")\n\n        d3.select(\"#chart\").append(\"div\")\n            .attr(\"class\", \"tooltip\")   \n            .style(\"display\", \"inline\");\n\n\n\n        //     groups = svg.selectAll('g')\n        //     .attr(\"id\", \"bargroups\")\n        //     .data(dataset)\n        //     .enter()\n        //     .append('svg')\n        //     .style('fill', function(d, i) {\n        //       var colors = ['#ff7f00', '#377eb8', '#e41a1c', '#999999']\n        //       return colors[i];\n        //     }),\n\n        //     rects = groups.selectAll('rect')\n        //     .data(function(d) {\n        //         return d;\n        //     })\n        //     .enter()\n        //     .append('rect')\n        //     .attr(\"id\", \"barrects\")\n        //     .attr('x', function(d) {\n        //         console.log('d')\n        //         console.log(d)\n        //         return xScale(d.x0);\n        //     })\n        //     .attr('y', function(d, i) {\n        //         return yScale(d.y);\n        //     })\n        //     .attr('height', function(d) {\n        //         return yScale.rangeBand();\n        //     })\n        //     .attr('width', function(d) {\n        //         return xScale(d.x);\n        //     })\n        //     .on('mouseover', mouseover)\n        //     .on(\"mousemove\", function(d) {\n        //         mousemove(d)\n        //     })\n        //     .on(\"mouseout\", mouseout);\n\n        // $scope.svg = svg\n\n        // var div = d3.select(\"#chart\").append(\"div\")\n        //     .attr(\"class\", \"tooltip\")\n        //     .style(\"display\", \"none\");\n\n        // function mouseover() {\n        //     div.style(\"display\", \"inline\");\n        // }\n\n        // function mousemove(d) {\n        //     div\n        //         .text(d.y + ': ' + d.x)\n        //         .style(\"opacity\", 1)\n        //         .style(\"left\", (d3.event.pageX - 34) + \"px\")\n        //         .style(\"top\", (d3.event.pageY - 12) + \"px\");\n        // }\n\n        // function mouseout() {\n        //     div.style(\"display\", \"none\");\n        // }\n    };\n\n\n\n\n})();\n(function() {\n  \n  angular\n    .module('meanApp')\n    .controller('userCtrl', userCtrl);\n\n  userCtrl.$inject = ['$location', '$routeParams', 'meanUsers'];\n  function userCtrl($location, $routeParams, meanUsers) {\n    console.log('in users.controller.js')\n    var username = $routeParams.username\n    var vm = this;\n\n    vm.towns = {};\n\n    meanUsers.singleUser(username)\n      .success(function(data) {\n        vm.towns = data;\n        console.log('town data:')\n        console.log(data);\n      })\n      .error(function (e) {\n        console.log(e);\n      });\n  }\n\n})();\n(function () {\n\n  angular\n  .module('meanApp')\n  .controller('loginCtrl', loginCtrl);\n\n  loginCtrl.$inject = ['$location', 'authentication'];\n  function loginCtrl($location, authentication) {\n    var vm = this;\n\n    vm.credentials = {\n      email : \"\",\n      password : \"\"\n    };\n\n    vm.onSubmit = function () {\n      authentication\n        .login(vm.credentials)\n        .error(function(err){\n          alert(err);\n        })\n        .then(function(){\n          $location.path('profile');\n        });\n    };\n\n  }\n\n})();\n(function () {\n\n  angular\n    .module('meanApp')\n    .controller('registerCtrl', registerCtrl);\n\n  function populateTowns(){\n    var fips6_list = [9030,11040,11015,11050,11060,13005,9080,9005,19050,19060,19085,9060,13015,11075,19070,9065,11080,13020,11020,19090,19020,11070,19015,11030,9015,9020,19055,19065,11010,11065,19095,9045,9025,15005,11045,19005,13010,15045,11025,5040,11035,19010,5070,19040,7050,9040,19030,15010,5060,13025,9050,19045,5010,7080,15030,15050,7075,5085,9055,9085,15025,15035,5025,5065,5030,15040,15020,5035,5075,9070,7045,5055,9035,23095,23100,7005,5080,23025,7060,5005,23050,5045,23030,7020,7040,23090,23045,23035,23060,23055,1095,5020,23070,1060,23040,23015,1025,23010,17040,23005,1015,17060,1100,1065,1075,1105,1050,17075,1005,17025,1110,17020,1055,1080,1010,1020,17070,17080,17030,1040,17065,1085,27075,1090,17050,27020,17055,27080,1070,21075,27085,27095,27055,27015,21005,27040,21047,27025,21135,21035,27045,27060,21110,27070,27115,21125,21060,21070,27050,21030,21065,27105,27005,27090,3045,3015,3030,3020,25050,25030,25110,3050,3075,3025,25045,25080,25095,3005,3070,25075,25015,25090,3060,3018,25073,25065,25060,25020,25025,3010,3080,3055,25105,25055,25010,3040,3035,3065,25100,25040,25035,25085,11055,15015,9075,7025,5015,7090,23020,7065,7055,7035,27065,27120,21095,7015,17010,17045,7030,5050,17035,7070,7085,17085,17015,17005,21085,21120,21130,21055,27110,27035,27030,27011,27100,19080,19035,19025,19075,23065,23080,25070,25005,1035,23075,23085,1030,1115,1045,21020,21115,21040,21015,21045,21010,21080,21140,21090,21100,21050,21025]\n    var towns = {}\n\n    for (i=0; i < fips6_list.length; i++) {\n      towns[fips6_list[i]] = 'Not yet'\n    }\n\n    return towns\n  }\n\n  registerCtrl.$inject = ['$location', 'authentication'];\n  function registerCtrl($location, authentication) {\n    var vm = this;\n\n    vm.credentials = {\n      name : \"\",\n      email : \"\",\n      password : \"\",\n      towns: populateTowns()\n    };\n\n    vm.onSubmit = function () {\n      console.log('Submitting registration');\n      console.log(vm.credentials);\n      authentication\n        .register(vm.credentials)\n        .error(function(err){\n          alert(err);\n        })\n        .then(function(){\n          $location.path('profile');\n        });\n    };\n\n  }\n\n})();\n(function () {\n\n  angular\n    .module('meanApp')\n    .service('authentication', authentication);\n\n  authentication.$inject = ['$http', '$window'];\n  function authentication ($http, $window) {\n\n    var saveToken = function (token) {\n      $window.localStorage['mean-token'] = token;\n    };\n\n    var getToken = function () {\n      return $window.localStorage['mean-token'];\n    };\n\n    var isLoggedIn = function() {\n      var token = getToken();\n      var payload;\n\n      if(token){\n        payload = token.split('.')[1];\n        payload = $window.atob(payload);\n        payload = JSON.parse(payload);\n\n        return payload.exp > Date.now() / 1000;\n      } else {\n        return false;\n      }\n    };\n\n    var currentUser = function() {\n      if(isLoggedIn()){\n        var token = getToken();\n        var payload = token.split('.')[1];\n        payload = $window.atob(payload);\n        payload = JSON.parse(payload);\n        return {\n          email : payload.email,\n          name : payload.name\n        };\n      }\n    };\n\n    register = function(user) {\n      return $http.post('/api/register', user).success(function(data){\n        console.log('registering user!')\n        console.log(data)\n        saveToken(data.token);\n      });\n    };\n\n    login = function(user) {\n      return $http.post('/api/login', user).success(function(data) {\n        saveToken(data.token);\n      });\n    };\n\n    logout = function() {\n      $window.localStorage.removeItem('mean-token');\n    };\n\n    return {\n      currentUser : currentUser,\n      saveToken : saveToken,\n      getToken : getToken,\n      isLoggedIn : isLoggedIn,\n      register : register,\n      login : login,\n      logout : logout\n    };\n  }\n\n\n})();\n(function() {\n\n  angular\n    .module('meanApp')\n    .service('meanData', meanData);\n\n  meanData.$inject = ['$http', 'authentication'];\n  function meanData ($http, authentication) {\n\n    var getProfile = function () {\n      return $http.get('/api/profile', {\n        headers: {\n          Authorization: 'Bearer '+ authentication.getToken()\n        }\n      });\n    };\n\n    var setProfile = function (input) {\n      console.log('in set prof')\n      console.log(authentication.getToken())\n      return $http.put('/api/profile/' + input.fips6, input, {\n        headers: {\n          Authorization: 'Bearer '+ authentication.getToken(),\n        }\n      });\n    };\n\n    return {\n      getProfile : getProfile,\n      setProfile : setProfile\n    };\n  }\n\n})();\n(function() {\n\n  angular\n    .module('meanApp')\n    .service('meanUsers', meanUsers);\n\n  meanUsers.$inject = ['$http', 'authentication'];\n\n  function meanUsers ($http, authentication) {\n\n    var getUsers = function () {\n      console.log('calling find all users')\n      return $http.get('/api/users', {\n      });\n    };\n\n    var singleUser = function (username) {\n      console.log('calling singleUser for: ' + username)\n      return $http.get('/api/users/' + username, {\n      });\n    };\n\n    return {\n      getUsers : getUsers,\n      singleUser : singleUser\n    };\n  }\n\n})();\n(function () {\n\n  angular\n    .module('meanApp')\n    .controller('navigationCtrl', navigationCtrl);\n\n  navigationCtrl.$inject = ['$location','authentication'];\n  function navigationCtrl($location, authentication) {\n    var vm = this;\n\n    vm.isLoggedIn = authentication.isLoggedIn();\n\n    vm.currentUser = authentication.currentUser();\n\n  }\n\n})();\n(function () {\n\n  angular\n    .module('meanApp')\n    .directive('navigation', navigation);\n\n  function navigation () {\n    return {\n      restrict: 'EA',\n      templateUrl: '/common/directives/navigation/navigation.template.html',\n      controller: 'navigationCtrl as navvm'\n    };\n  }\n\n})();"],"sourceRoot":"/source/"}